# Introducci√≥n: De Tibbles a DataFrames

En el Tidyverse, la unidad fundamental es el `tibble`. En Pandas, es el `DataFrame`. Son muy similares, pero hay diferencias **cr√≠ticas** que debes entender desde el d√≠a 1.

```{pyodide}
#| echo: true
import pandas as pd
import numpy as np

# ============================================
# DATOS ENRIQUECIDOS PARA SPORT SCIENTISTS
# ============================================
# Dataset ATLETAS: Perfil f√≠sico completo del plantel
atletas = pd.DataFrame({
    'JugadorID': [f'ATL_{i:03d}' for i in range(1, 16)],
    'Nombre': ['Garc√≠a', 'L√≥pez', 'Mart√≠nez', 'S√°nchez', 'Fern√°ndez', 
               'Gonz√°lez', 'Rodr√≠guez', 'P√©rez', 'G√≥mez', 'Ruiz',
               'D√≠az', 'Moreno', '√Ålvarez', 'Jim√©nez', 'Romero'],
    'Posicion': ['Delantero', 'Mediocentro', 'Defensa', 'Portero', 'Delantero',
                'Mediocentro', 'Defensa', 'Delantero', 'Mediocentro', 'Defensa',
                'Portero', 'Delantero', 'Mediocentro', 'Defensa', 'Extremo'],
    'Edad': [25, 28, 23, 31, 22, 27, 29, 24, 26, 30, 33, 21, 25, 28, 23],
    'Altura_cm': [178, 175, 182, 188, 176, 180, 185, 173, 177, 184, 190, 172, 179, 183, 175],
    'Peso_kg': [75, 72, 80, 85, 70, 76, 82, 68, 74, 81, 87, 67, 73, 79, 71],
    # M√©tricas fisiol√≥gicas
    'VO2max': [58.5, 62.1, 55.0, 48.2, 60.5, 59.0, 54.5, 61.0, 57.5, 53.0, 46.0, 63.0, 58.0, 55.5, 59.5],
    'FC_Max': [195, 188, 192, 185, 198, 190, 186, 196, 191, 184, 180, 200, 193, 187, 197],
    'FC_Reposo': [52, 48, 55, 58, 50, 51, 54, 49, 53, 56, 60, 47, 52, 55, 50],
    # Rendimiento f√≠sico
    'VelocidadMax_kmh': [32.5, 31.0, 30.2, 28.5, 33.8, 31.5, 29.8, 34.2, 30.5, 29.0, 27.5, 35.0, 31.2, 29.5, 33.0],
    'Potencia_W': [850, 780, 920, 950, 720, 810, 890, 700, 790, 880, 920, 680, 800, 860, 740],
    'SaltoCMJ_cm': [42, 38, 45, 48, 40, 41, 44, 39, 40, 43, 46, 37, 41, 44, 39],
    'YoYo_IR1_m': [2120, 2400, 1840, 1280, 2280, 2200, 1720, 2360, 2040, 1680, 1120, 2520, 2080, 1800, 2240],
    # Composici√≥n corporal
    'Grasa_Corporal_pct': [10.2, 9.8, 11.5, 13.2, 9.5, 10.0, 11.8, 9.2, 10.5, 12.0, 14.5, 8.8, 10.3, 11.2, 9.6]
})

# Dataset GPS: Sesiones de entrenamiento y partidos
gps = pd.DataFrame({
    'JugadorID': ['ATL_001', 'ATL_002', 'ATL_001', 'ATL_003', 'ATL_002', 
                 'ATL_001', 'ATL_003', 'ATL_002', 'ATL_001', 'ATL_004'] * 3,
    'TipoSesion': ['Entrenamiento', 'Partido', 'Partido', 'Entrenamiento', 'Entrenamiento',
                  'Entrenamiento', 'Partido', 'Partido', 'Partido', 'Entrenamiento'] * 3,
    'Distancia_Total_m': [4500, 10200, 9800, 3200, 4100, 5600, 11500, 10800, 11000, 3000] * 3,
    'HSR_m': [150, 800, 750, 50, 120, 300, 950, 880, 900, 20] * 3,
    'Sprint_m': [45, 280, 250, 15, 35, 90, 320, 300, 310, 5] * 3,
    'RPE': [3, 8, 9, 2, 4, 5, 10, 8, 9, 2] * 3,
    'Duracion_min': [60, 95, 95, 45, 60, 75, 98, 96, 95, 40] * 3,
    'HR_Media': [135, 165, 168, 125, 140, 145, 172, 167, 170, 120] * 3,
    'Fecha': pd.date_range(start='2024-01-01', periods=30).strftime('%Y-%m-%d').tolist()
})

print("‚úÖ Datos cargados correctamente")
print(f"   atletas: {atletas.shape[0]} filas x {atletas.shape[1]} columnas")
print(f"   gps: {gps.shape[0]} filas x {gps.shape[1]} columnas")
print(f"\nüìã Variables de atletas: {', '.join(atletas.columns[:6])}...")
```

***

## 1. Series: El Vector de Pandas

En R/Tidyverse, un vector at√≥mico es la estructura m√°s b√°sica. En Pandas, el equivalente es la **Series**: un array unidimensional con etiquetas (√≠ndice).

### Ejemplo 1.1: Crear una Series desde una lista

**En R (Tidyverse):**
```r
frecuencias_cardiacas <- c(180, 175, 182, 168)
```

**En Pandas:**
```{pyodide}
frecuencias_cardiacas = pd.Series([180, 175, 182, 168])
print(frecuencias_cardiacas)
print(f"\nTipo: {type(frecuencias_cardiacas)}")
```

**¬øPor qu√© esto importa?** A diferencia de un vector de R, una Series de Pandas tiene **dos partes visibles**: el √≠ndice (0, 1, 2, 3 por defecto) y los valores. Esto permite acceder a los datos tanto por posici√≥n como por etiqueta.

---

### üß† Pr√°ctica 1.1: Crea tu primera Series

Crea una Series llamada `pesos` con los valores: 75.5, 82.3, 68.0, 90.1

```{pyodide}
# Pista 1: Usa pd.Series([...])
# Pista 2: Los valores van dentro de una lista []

# Escribe tu c√≥digo aqu√≠:


```

::: {.callout-tip collapse="true"}
## Ver soluci√≥n
```python
pesos = pd.Series([75.5, 82.3, 68.0, 90.1])
print(pesos)
```
:::

---

### Ejemplo 1.2: Series con √≠ndice personalizado

**En R (Tidyverse):**
```r
vo2max <- c(Jugador_A = 58.5, Jugador_B = 62.1)
vo2max["Jugador_B"]
```

**En Pandas:**
```{pyodide}
vo2max = pd.Series(
    data=[58.5, 62.1, 55.0, 48.2],
    index=['Jugador_A', 'Jugador_B', 'Jugador_C', 'Jugador_D'],
    name='VO2max'
)
print(vo2max)
print(f"\nAcceso por etiqueta: {vo2max['Jugador_B']}")
```

**¬øPor qu√© es poderoso?** Al darle √≠ndice con nombres, el acceso es expl√≠cito. No necesitas recordar posiciones.

---

### üß† Pr√°ctica 1.2: Series con √≠ndice

Crea una Series de RPE (escala 1-10) para 3 d√≠as: 'Lunes', 'Mi√©rcoles', 'Viernes', con valores 7, 8, 6. Accede al RPE del Mi√©rcoles.

```{pyodide}
# Pista 1: pd.Series(data=[...], index=[...])
# Pista 2: Accede con serie['nombre_indice']

# Escribe tu c√≥digo aqu√≠:


```

::: {.callout-tip collapse="true"}
## Ver soluci√≥n
```python
rpe = pd.Series(data=[7, 8, 6], index=['Lunes', 'Mi√©rcoles', 'Viernes'])
print(rpe['Mi√©rcoles'])
```
:::

---

## 2. DataFrame: La Tabla de Pandas

El DataFrame es una colecci√≥n de Series que comparten el mismo √≠ndice.

### Ejemplo 2.1: Crear DataFrame desde diccionario

**En R (Tidyverse):**
```r
atletas_mini <- tibble(
  Nombre = c('Garc√≠a', 'L√≥pez', 'Mart√≠nez'),
  Posicion = c('Delantero', 'Mediocentro', 'Defensa'),
  Edad = c(25, 28, 23)
)
```

**En Pandas:**
```{pyodide}
atletas_mini = pd.DataFrame({
    'Nombre': ['Garc√≠a', 'L√≥pez', 'Mart√≠nez'],
    'Posicion': ['Delantero', 'Mediocentro', 'Defensa'],
    'Edad': [25, 28, 23]
})
atletas_mini
```

**¬øQu√© est√° pasando?** Las claves del diccionario se convierten en nombres de columnas, los valores (listas) en los datos.

---

### üß† Pr√°ctica 2.1: Tu primer DataFrame

Crea un DataFrame de 3 sesiones de entrenamiento con columnas: 'Fecha', 'Tipo', 'Duracion_min'.

```{pyodide}
# Pista 1: pd.DataFrame({...})
# Pista 2: Cada columna es 'nombre': [valores]

# Escribe tu c√≥digo aqu√≠:


```

::: {.callout-tip collapse="true"}
## Ver soluci√≥n
```python
sesiones = pd.DataFrame({
    'Fecha': ['2024-01-15', '2024-01-17', '2024-01-19'],
    'Tipo': ['Fuerza', 'T√©cnico', 'Partido'],
    'Duracion_min': [60, 90, 95]
})
print(sesiones)
```
:::

---

## 3. Exploraci√≥n R√°pida

### Ejemplo 3.1: Atributos del DataFrame

**En R (Tidyverse):**
```r
atletas %>% dim()
atletas %>% names()
atletas %>% glimpse()
```

**En Pandas:**
```{pyodide}
print("Forma (filas, columnas):", atletas.shape)
print("\nColumnas:", atletas.columns.tolist())
print("\nTipos de datos:")
print(atletas.dtypes)
```

### Ejemplo 3.2: Estad√≠sticas b√°sicas

```{pyodide}
atletas.describe()
```

---

## 4. El √çndice: La Diferencia Clave

### Ejemplo 4.1: set_index para b√∫squedas r√°pidas

```{pyodide}
# Convertir JugadorID en √≠ndice
atletas_idx = atletas.set_index('JugadorID')

# B√∫squeda instant√°nea O(1)
print(atletas_idx.loc['ATL_005'][['Nombre', 'VO2max']])
```

**¬øPor qu√© importa?** Con millones de filas, `filter()` escanea toda la tabla. Con √≠ndice, `.loc['ATL_005']` es instant√°neo.

---

### üß† Pr√°ctica 3.1: Trabajando con √≠ndices

Indexa el DataFrame `atletas` por 'Nombre' y busca los datos del atleta 'L√≥pez'.

```{pyodide}
# Pista 1: .set_index('columna')
# Pista 2: .loc['valor_a_buscar']

# Escribe tu c√≥digo aqu√≠:


```

::: {.callout-tip collapse="true"}
## Ver soluci√≥n
```python
atletas_por_nombre = atletas.set_index('Nombre')
print(atletas_por_nombre.loc['L√≥pez'])
```
:::

---

## 5. Vistas vs Copias: El Error M√°s Com√∫n

**Regla de oro:** Siempre usa `.copy()` cuando vayas a modificar un subset filtrado.

```{pyodide}
# ‚úÖ CORRECTO
subset_safe = atletas[atletas['Posicion'] == 'Delantero'].copy()
subset_safe['Nueva_Col'] = 100
print(subset_safe[['Nombre', 'Nueva_Col']].head())
```

---

***

## üèÜ Mini-Proyecto: Perfil del Plantel

Ahora que conoces las estructuras b√°sicas, responde estas preguntas de an√°lisis del plantel:

### Pregunta 1: Dimensiones del Dataset
¬øCu√°ntos atletas hay en total y cu√°ntas m√©tricas f√≠sicas se han registrado?

```{pyodide}
# Pista: Usa .shape para ver (filas, columnas)

# Tu c√≥digo aqu√≠:


```

::: {.callout-tip collapse="true"}
## Ver soluci√≥n
```python
print(f"Atletas: {atletas.shape[0]}")
print(f"M√©tricas registradas: {atletas.shape[1]} variables")
print(f"\nVariables disponibles:\n{atletas.columns.tolist()}")
```
:::

### Pregunta 2: ¬øQui√©n es el atleta m√°s r√°pido del plantel?
Encuentra el jugador con mayor velocidad m√°xima y muestra su nombre, posici√≥n y velocidad.

```{pyodide}
# Pista: Usa .idxmax() para encontrar el √≠ndice del valor m√°ximo

# Tu c√≥digo aqu√≠:


```

::: {.callout-tip collapse="true"}
## Ver soluci√≥n
```python
idx_max = atletas['VelocidadMax_kmh'].idxmax()
print(f"Atleta m√°s r√°pido: {atletas.loc[idx_max, 'Nombre']}")
print(f"Posici√≥n: {atletas.loc[idx_max, 'Posicion']}")
print(f"Velocidad m√°xima: {atletas.loc[idx_max, 'VelocidadMax_kmh']} km/h")
```
:::

### Pregunta 3: Reserva de Frecuencia Card√≠aca
La reserva de FC = FC_Max - FC_Reposo. ¬øCu√°l es la reserva media del plantel?

```{pyodide}
# Pista: Puedes restar dos columnas directamente

# Tu c√≥digo aqu√≠:


```

::: {.callout-tip collapse="true"}
## Ver soluci√≥n
```python
reserva_fc = atletas['FC_Max'] - atletas['FC_Reposo']
print(f"Reserva FC media: {reserva_fc.mean():.1f} ppm")
print(f"Rango: {reserva_fc.min()} - {reserva_fc.max()} ppm")
```
:::

### Pregunta 4: Perfil por Posici√≥n
¬øCu√°ntos jugadores hay en cada posici√≥n? ¬øQu√© posici√≥n es m√°s com√∫n?

```{pyodide}
# Pista: .value_counts() cuenta frecuencias

# Tu c√≥digo aqu√≠:


```

::: {.callout-tip collapse="true"}
## Ver soluci√≥n
```python
print("Distribuci√≥n por posici√≥n:")
print(atletas['Posicion'].value_counts())
print(f"\nPosici√≥n m√°s com√∫n: {atletas['Posicion'].value_counts().index[0]}")
```
:::

### Pregunta 5: Atletas en su Prime (25-29 a√±os)
¬øCu√°ntos atletas est√°n en su "prime" (entre 25 y 29 a√±os)?

```{pyodide}
# Pista: Usa operadores l√≥gicos & para combinar condiciones

# Tu c√≥digo aqu√≠:


```

::: {.callout-tip collapse="true"}
## Ver soluci√≥n
```python
prime = atletas[(atletas['Edad'] >= 25) & (atletas['Edad'] <= 29)]
print(f"Atletas en prime (25-29 a√±os): {len(prime)}")
print(prime[['Nombre', 'Edad', 'Posicion']])
```
:::

---

## Resumen: Tabla de Equivalencias

| Concepto | R (Tidyverse) | Python (Pandas) |
|----------|---------------|-----------------|
| Vector | `c(1, 2, 3)` | `pd.Series([1, 2, 3])` |
| DataFrame | `tibble(...)` | `pd.DataFrame({...})` |
| Ver estructura | `df %>% glimpse()` | `df.info()` |
| Estad√≠sticas | `df %>% summary()` | `df.describe()` |
| Conteo | `df %>% count(col)` | `df['col'].value_counts()` |
