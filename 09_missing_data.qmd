# Manejo de Datos Faltantes

Este cap√≠tulo cubre la detecci√≥n, eliminaci√≥n e imputaci√≥n de NA.

```{pyodide}
import pandas as pd
import numpy as np

# ============================================
# DATOS CON VALORES FALTANTES (Simulaci√≥n realista)
# ============================================
# Simula datos de GPS con fallos de sensor/registros incompletos
np.random.seed(42)

gps_con_na = pd.DataFrame({
    'JugadorID': [f'ATL_{i:03d}' for i in range(1, 11)],
    'Nombre': ['Garc√≠a', 'L√≥pez', None, 'S√°nchez', 'Fern√°ndez', 
               'Gonz√°lez', None, 'P√©rez', 'G√≥mez', 'Ruiz'],
    'Posicion': ['Delantero', 'Mediocentro', 'Defensa', None, 'Delantero',
                 'Mediocentro', 'Defensa', 'Delantero', None, 'Defensa'],
    'Distancia_m': [10200, 9800, 11000, np.nan, 9500, 8800, 10500, np.nan, 9200, 10100],
    'HSR_m': [850, np.nan, 920, 780, np.nan, 650, 900, 880, 720, np.nan],
    'VO2max': [58.5, np.nan, 55.0, 48.2, np.nan, 59.0, 54.5, 61.0, np.nan, 53.0],
    'RPE': [8, 7, 9, np.nan, 8, 6, np.nan, 8, 7, 9]
})

print("‚úÖ Datos GPS con valores faltantes cargados")
print(f"\nüìä Resumen de nulos:")
print(gps_con_na.isnull().sum())
print(f"\nTotal de valores nulos: {gps_con_na.isnull().sum().sum()}")
```

***

## 1. Detecci√≥n de Missing

### Ejemplo 1.1: Contar nulos

**En R:** `atletas %>% summarise(across(everything(), ~sum(is.na(.))))`

```{pyodide}
print("Nulos por columna:")
print(atletas.isnull().sum())
```

### Ejemplo 1.2: Filas con alg√∫n nulo

```{pyodide}
atletas[atletas.isnull().any(axis=1)]
```

---

### üß† Pr√°ctica 1.1

¬øQu√© porcentaje de valores son nulos en la columna 'VO2max'?

```{pyodide}
# Pista: (df['col'].isnull().sum() / len(df)) * 100

# Escribe tu c√≥digo aqu√≠:


```

::: {.callout-tip collapse="true"}
## Ver soluci√≥n
```python
pct = (atletas['VO2max'].isnull().sum() / len(atletas)) * 100
print(f"{pct:.1f}% de valores nulos")
```
:::

***

## 2. Eliminaci√≥n de Missing

### Ejemplo 2.1: dropna

**En R:** `atletas %>% drop_na()`

```{pyodide}
# Eliminar filas con CUALQUIER nulo
atletas_completos = atletas.dropna()
print(f"Original: {len(atletas)}, Despu√©s de dropna: {len(atletas_completos)}")
```

### Ejemplo 2.2: dropna con subset

```{pyodide}
# Solo eliminar si hay nulo en columnas espec√≠ficas
atletas.dropna(subset=['Nombre'])
```

---

### üß† Pr√°ctica 2.1

Elimina solo las filas donde 'Edad' sea nulo.

```{pyodide}
# Pista: .dropna(subset=['columna'])

# Escribe tu c√≥digo aqu√≠:


```

::: {.callout-tip collapse="true"}
## Ver soluci√≥n
```python
atletas.dropna(subset=['Edad'])
```
:::

***

## 3. Imputaci√≥n de Missing

### Ejemplo 3.1: fillna con valor

**En R:** `replace_na(list(col = valor))`

```{pyodide}
# Rellenar con un valor espec√≠fico
atletas.fillna({'VO2max': 0, 'Edad': 0}).head()
```

### Ejemplo 3.2: fillna con estad√≠stico

```{pyodide}
# Rellenar con la media
atletas_imp = atletas.copy()
atletas_imp['VO2max'] = atletas_imp['VO2max'].fillna(atletas_imp['VO2max'].mean())
atletas_imp['Edad'] = atletas_imp['Edad'].fillna(atletas_imp['Edad'].median())
atletas_imp
```

---

### üß† Pr√°ctica 3.1

Rellena los nulos de 'Edad' con la mediana.

```{pyodide}
# Pista: .fillna(df['col'].median())

# Escribe tu c√≥digo aqu√≠:


```

::: {.callout-tip collapse="true"}
## Ver soluci√≥n
```python
atletas['Edad'].fillna(atletas['Edad'].median())
```
:::

***

## üèÜ Mini-Proyecto: Limpieza de Datos

### Pregunta 1
¬øCu√°ntos atletas tienen al menos un valor faltante?

```{pyodide}
# Escribe tu c√≥digo aqu√≠:


```

::: {.callout-tip collapse="true"}
## Ver soluci√≥n
```python
len(atletas[atletas.isnull().any(axis=1)])
```
:::

### Pregunta 2
Si eliminas todos los nulos, ¬øcu√°ntos atletas quedan?

```{pyodide}
# Escribe tu c√≥digo aqu√≠:


```

::: {.callout-tip collapse="true"}
## Ver soluci√≥n
```python
len(atletas.dropna())
```
:::

### Pregunta 3
Imputa los valores faltantes de VO2max con la media. ¬øCu√°l es la nueva media?

```{pyodide}
# Escribe tu c√≥digo aqu√≠:


```

::: {.callout-tip collapse="true"}
## Ver soluci√≥n
```python
media_original = atletas['VO2max'].mean()
vo2_imputado = atletas['VO2max'].fillna(media_original)
print(f"Media original: {media_original:.2f}")
print(f"Media despu√©s de imputar: {vo2_imputado.mean():.2f}")
```
:::

### Pregunta 4
¬øQu√© atletas tienen nombre faltante? Muestra sus IDs.

```{pyodide}
# Escribe tu c√≥digo aqu√≠:


```

::: {.callout-tip collapse="true"}
## Ver soluci√≥n
```python
atletas[atletas['Nombre'].isna()]['JugadorID'].tolist()
```
:::

---

## Resumen

| Operaci√≥n | R (tidyr) | Python (Pandas) |
|-----------|-----------|-----------------|
| Detectar NA | `is.na(x)` | `.isna()` |
| Eliminar NA | `drop_na()` | `.dropna()` |
| Reemplazar | `replace_na(val)` | `.fillna(val)` |
| Media | `mean(x, na.rm=T)` | `.mean()` (ignora NA) |
